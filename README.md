# 股票趨勢/價格預測
![](https://img.shields.io/badge/Python-3776AB?style=for-the-badge&logo=python&logoColor=white)

K 線圖是金融市場中常用的價格行為視覺化工具，投資人常藉由特定 K 線型態判斷短期趨勢。然而，K 線本身屬於視覺型資訊，無法直接應用於資料探勘與機器學習模型中。此專案將 K 線型態轉換為數值特徵，結合成交量與短期趨勢資訊，建構可程式化的 K 線型態模型，並探討其對三日後股價漲跌之預測能力。

此專案使用 10 檔台灣上市股票，蒐集 2016–2025 年之歷史交易資料，並排除除權息造成之非交易性價格跳動。研究中分別採用三種方法：(1) 型態相似度比對法、(2) Autoencoder 型態學習法、(3) Autoencoder 搭配 One-Class SVM 之異常型態判別法，進行回測比較。此外，亦透過基因演算法自動生成具高報酬潛力之 K 線型態。實驗結果顯示，所提出的方法能在風險控制與報酬率之間取得良好平衡，且部分 K 線型態具有統計顯著性，顯示其預測能力非偶然。

## 資料來源與前處理
### 資料來源

此專案使用 Python 套件 yfinance 擷取台灣股市資料，共選用 10 檔股票，資料期間為 2016 年 1 月至 2025 年 12 月。資料欄位包含：開盤價（Open）、最高價（High）、最低價（Low）、收盤價（Close）、調整後收盤價（Adj Close）與成交量（Volume）。

資料切分方式如下：  
訓練資料：2016–2024 年  
測試資料：2025 年

### 除權息資料處理

除權息會造成股價出現非交易行為導致的跳空，若直接納入分析，將導致模型學習到錯誤的價格變化模式。因此，此專案使用 yfinance 提供之 dividends 資料，找出各股票於研究期間內之除權息日期，並將該日期之 K 線資料自資料集中移除。

此步驟可有效避免模型將非市場行為誤判為有效交易型態，提升分析可靠度。

## K 線型態特徵設計
為使 K 線能被模型處理，此專案將每一交易日轉換為 10 維數值特徵，分別描述當日價格結構、前一日型態、跳空關係、成交量變化與短期趨勢。

特徵說明如下：  
當日上影線：(H − max(O, C)) / C  
當日下影線：(min(O, C) − L) / C  
當日實體：(C − O) / C  
前一日上影線：shift(1)  
前一日下影線：shift(1)  
前一日實體：shift(1)  
開盤型態：(O − Cₜ₋₁) / C  
收盤型態：(C − Cₜ₋₁) / C  
成交量比：(V − MA5) / V  
五日趨勢：(Cₜ₋₂ − Cₜ₋₇) / Cₜ₋₇

## K 線型態搜尋與相似度比對
### 型態定義
定義三日後報酬率：  
r(t,3) = (Cₜ₊₃ − Cₜ) / Cₜ

看漲型態：r(t,3) > +5%  
看跌型態：r(t,3) < −5%

僅保留符合上述條件之 K 線作為候選型態。

### 加權相似度比對方法

為評估兩個 K 線型態之相似程度，使用加權歐氏距離，並將距離轉換為相似度分數。

其中權重來自 XGBoost 模型訓練後之特徵重要性，使對預測影響較大的特徵在距離計算中占較高比重。

找到的漲跌 K 線型態分別放回到過往的歷史資料進行二次篩選, 找出出現頻率較高, 且預測比較正確的K線型態。
依獲利情形排序, 找出符合條件的看漲及看跌的K線型態, 並記錄下來。

## 統計檢定驗證型態有效性
為驗證所找到的 K 線型態是否具有統計意義，使用 Welch’s t-test，比較下列兩組資料：  
一、該型態出現日之三日後報酬  
二、全體交易日之三日後報酬

## 三種方法
### 方法一：Pattern-based 相似度比對
當測試資料中某日 K 線與任一已知型態相似度高於門檻值時，於當日收盤價進場，三日後收盤價出場。

### 方法二：Autoencoder 型態學習
使用 Autoencoder（10→8→4→8→10）學習 K 線型態之低維表示（latent code），以重建誤差分析型態分布。

### 方法三：One-Class SVM
將 latent code 作為輸入，分別訓練上漲與下跌之 One-Class SVM，以判斷是否落入典型型態區域。

依三個不同的方法的判斷結果進行簡單買賣操作(出現pattern的當天收盤價買入/賣出, 三天後的收盤價賣出/買入)
## 基因演算法
以 K 線型態為基礎, 設計一染色體, 找出可以在 2016-2024 獲利的上漲及下跌的K線型態。

Fitness function 為使用該 K 線型態到 2016-2024 進行投資時可以得到最多的出現次數以及最大平均獲利出現以及最小的最大回撤。

最終找到的 K 線型態用前面三種方法找到的最佳方法進行學習, 然後用2025年資料進行回測。

## 輸出結果包含
1. 個股近三年 K 線走勢(ex:2330)

![image1](https://github.com/vincent9457/Data-Mining/blob/main/README_imgs/Picture4.png)

2. 個股三種方法 + GA 的一年期總報酬率、勝率、最大回撤(ex:2330)

![image1](https://github.com/vincent9457/Data-Mining/blob/main/README_imgs/Picture3.png)

3. 共現率分析

![image1](https://github.com/vincent9457/Data-Mining/blob/main/README_imgs/Picture1.png)

4. Autoencoder latent code PCA 視覺化

![image1](https://github.com/vincent9457/Data-Mining/blob/main/README_imgs/Picture2.png)

